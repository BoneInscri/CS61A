## 1.3 Formulating Abstractions with Higher-Order Procedures



（1）任何一门语言都应该具有定义过程的能力

（2）过程是一种抽象

比如：

```lisp
(define (cube x) (* x x x))
```

上面的过程就是 下面三个表达式的抽象

```lisp
(* 3 3 3)
(* x x x)
(* y y y) 
```



过程也可以被操作，**操作过程的过程被称为高阶过程**

Procedures that manipulate procedures are called **higher-order procedures.**

我们**需要构造可以接受过程作为参数或将过程作为值返回的过程**。

即我们不能限制过程的参数只能是数字，还可以让其参数设置为过程！

### 1.3.1 Procedures as Arguments

```lisp
;  the sum of the integers from a through b
(define (sum-integers a b)
  (if (> a b)
      0
      (+ a (sum-integers (+ a 1) b))))

; the sum of the cubes of the integers in the given range
(define (sum-cubes a b)
  (if (> a b)
      0
      (+ (cube a) (sum-cubes (+ a 1) b))))
```

还可以计算特定的序列？

```lisp
(define (pi-sum a b)
  (if (> a b)
      0
      (+ (/ 1.0 (* a (+ a 2))) (pi-sum (+ a 4) b))))
```

$$
\left(\pi/4\right)=1-\left(1/3\right)+\left(1/5\right)-\left(1/7\right)+\cdots,\\
\pi/8=\frac{1}{1\cdot3}+\frac{1}{5\cdot7}+\frac{1}{9\cdot11}+\cdots
$$

在很大程度上是相同的，**不同之处在于**

- 过程的**名称**
- 用于计算要添加的**项的a的函数**
- 提供**a的下一个值的函数**

主要就两点：**每个项长什么样？如何得到下一个项？**

```lisp
(define (<name> a b)
  (if (> a b)
      0
      (+ (<term> a)
         (<name> (<next> a) b))))
```

这其实就是下面的求和过程，即Sima符号就是这么来的：
$$
\sum_{n=a}^{b}f(n)=f(a)+\cdots+f(b)
$$
于是sum 可以写成：

```lisp
(define (sum term a next b)
  (if (> a b)
      0
      (+ (term a)
         (sum term (next a) next b))))
```

立方和可以写成下面的形式：

```lisp
(define (sum-cubes a b)
	(define (inc n) (+ n 1))
	(define (cube a) (* a a a))
    (sum cube a inc b))
(sum-cubes 1 10)
; 3025
```

直接求一个范围的和，可以写成下面的形式：

```lisp
(define (sum-integers a b)
    (define (inc n) (+ n 1))
    (define (identity x) x)
    (sum identity a inc b))
(sum-integers 1 10)
; 55
```

pi 也可以通过下面的方式进行计算：

```lisp
(define (pi-sum a b)
  (define (pi-term x)
    (/ 1.0 (* x (+ x 2))))
  (define (pi-next x)
    (+ x 4))
  (sum pi-term a pi-next b))
(* 8 (pi-sum 1 1000))
; 3.139592655589783
```

通过上面的高阶过程的抽象，可以实现a 到 b 的定积分：

```lisp
(define (integral f a b dx)
  (define (add-dx x) (+ x dx))
  (* (sum f (+ a (/ dx 2.0)) add-dx b) dx))
(integral cube 0 1 0.01)
.24998750000000042
(integral cube 0 1 0.001)
.249999875000001
```

$$
\int_{a}^{b}f=\left[f\left(a+\frac{dx}{2}\right)+f\left(a+dx+\frac{dx}{2}\right)+f\left(a+2dx+\frac{dx}{2}\right)+\cdots\right]dx
$$

(The exact value of **the integral of `cube` between 0 and 1 is 1/4.**)





